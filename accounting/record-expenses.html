<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Expenses</title>
    <style>
        .tag {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background-color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
        }
        .tag.selected {
            background-color: #ff4081;
            color: white;
        }
    </style>
</head>
<body>
    <label for="content-input">明目</label>
    <input type="text" id="content-input" placeholder="明目 金额, 例如[吃饭 12.1]">
    <br><br>
    <div id="tag-container">
    </div>
    <br>
    <button id="submit-btn" class="submit-btn disabled" onclick="submitData()">记录到Notion</button>
<p id="o"></p>
    <script>
        let tags = ['餐饮美食','日常购物','医疗保健','交通出行','休闲娱乐','服饰美容','旅游放松','水电网','人情往来','家居硬体','房贷房租物管','车贷','宠物','其他']; 
        let selectedTag = null; 

        
        function renderTags() {
            const tagContainer = document.getElementById("tag-container");
            tagContainer.innerHTML = "";
            tags.forEach(tag => {
                const tagElement = document.createElement("div");
                tagElement.classList.add("tag");
                tagElement.textContent = tag;
                tagElement.onclick = () => selectTag(tag);
                if (tag === selectedTag) {
                    tagElement.classList.add("selected");
                }
                tagContainer.appendChild(tagElement);
            });
        }

        
        function selectTag(tagName) {
            selectedTag = tagName;
            renderTags();
            toggleSubmitButton();
        }

        
        function toggleSubmitButton() {
            const contentInput = document.getElementById("content-input").value;
            const submitButton = document.getElementById("submit-btn");
            if (contentInput.trim() !==  && selectedTag !== null){
                submitButton.classList.remove("disabled");
            } else {
                submitButton.classList.add("disabled");
            }
        }

        
        function submitData() {
            const contentInput = document.getElementById("content-input").value;
            const [title, amount] = contentInput.split(" ");
            const shortcutUrl = 'shortcuts://run-shortcut?name=QQ&input=text&text='+encodeURIComponent(title+' '+title+amount+' '+selectedTag);
            document.getElementById("o").innerHTML = '<a href="'+shortcutUrl+'">'+shortcutUrl+'</a>';
            // sendObjectMessage(`${encodeURIComponent(title+" "+amount+" "+selectedTag)}`);
            window.location.href = shortcutUrl;
            setTimeout(()=>{
                window.close();
            },500)

        }

        async function fetchDataAndExtractTags() {
            renderTags();
        }

        window.onload = fetchDataAndExtractTags;

        document.getElementById(content-input).addEventListener(input, toggleSubmitButton);
    </script>
</body>
</html>
